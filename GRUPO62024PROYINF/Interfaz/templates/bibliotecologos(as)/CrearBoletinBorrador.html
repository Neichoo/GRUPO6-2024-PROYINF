<!DOCTYPE html>
<html lang="es">
<head>
    {% load static %}
    <meta charset="UTF-8">
    <title>VIGIFIA: Crear Bolet√≠n</title>
    <link rel="stylesheet" href="{% static 'CSS/Navbar.css' %}">
    <link rel="stylesheet" href="{% static 'CSS/CrearBoletinBorrador.css' %}">
    <link rel="stylesheet" href="{% static 'CSS/Footer.css' %}">

    <!-- TinyMCE Editor -->
    <script src="https://cdn.tiny.cloud/1/dn8swrrkyf5nwaeh6hhmt0tabrog4l03n4bn7uzwzwdk7k1t/tinymce/6/tinymce.min.js" referrerpolicy="origin"></script>
    <script>
    tinymce.init({
        selector: 'textarea#basic-example',
        height: 500,
        plugins: [
            'advlist', 'autolink', 'lists', 'link', 'image', 'charmap', 'preview',
            'anchor', 'searchreplace', 'visualblocks', 'code', 'fullscreen',
            'insertdatetime', 'media', 'table', 'help', 'wordcount'
        ],
        toolbar: 'undo redo | blocks | ' +
        'bold italic backcolor | alignleft aligncenter ' +
        'alignright alignjustify | bullist numlist outdent indent | ' +
        'removeformat | help',
        content_style: 'body { font-family:Helvetica,Arial,sans-serif; font-size:16px }'
    });
    </script>

    <!-- html2pdf.js para PDF local -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>
</head>
<body>
    {% include 'base/componentes/Navbar.html' %}

    <form method="POST" action="{% url 'CrearBoletinBorrador' %}" id="form-guardar">
        {% csrf_token %}
        <input type="text" name="nombre_boletin" placeholder="Nombre del bolet√≠n" class="campo-nombre">

        <textarea id="basic-example" name="basic-example">
<h1 style="color: #216c2c;">Titulo Boletin</h1>

<p style="color: #000000;">
Con el objetivo de fortalecer el desarrollo sustentable del sector agroalimentario, la Fundaci√≥n para la Innovaci√≥n Agraria presenta este bolet√≠n generado mediante vigilancia estrat√©gica. Este informe cubre temas como {{temas_principales}} y est√° optimizado para consulta en dispositivos m√≥viles.
</p>

<ul style="color: #000000;">
<li>Una <strong>fuente b√°sica</strong> de informaci√≥n tecnol√≥gica</li>
<li>Un bolet√≠n <strong>especializado</strong> sobre {{lineamiento}}</li>
<li>Un resumen üß† para tomadores de decisi√≥n</li>
<li>Un informe adaptable a <code>&lt;contexto&gt;</code> regional</li>
<li>Una herramienta de monitoreo clim√°tico y agr√≠cola</li>
</ul>

<h2 style="color: #216c2c;">√öltimas noticias destacadas</h2>

<h3 style="color: #ffffff; background-color: #216c2c;">noticia_1_titulo</h3>
<p><em>noticia_1_fecha</em></p>
<p>noticia_1_resumen</p>
<p><a href="{{noticia_1_url}}" target="_blank">Ver m√°s</a></p>

<h3 style="color: #ffffff; background-color: #216c2c;">noticia_2_titulo</h3>
<p><em>noticia_2_fecha</em></p>
<p>noticia_2_resumen</p>
<p><a href="{{noticia_2_url}}" target="_blank">Ver m√°s</a></p>

<hr>

<h2 style="color: #216c2c;">Contacto y Cr√©ditos</h2>
<p>Fundaci√≥n para la Innovaci√≥n Agraria ‚Äì FIA</p>
<p>Bolet√≠n N¬∞{{numero_boletin}} ‚Äì {{mes}} {{a√±o}}</p>
        </textarea>

        <br>
        <div class="botones">
            <button type="submit" class="btn-guardar">Guardar borrador (BD + PDF)</button>
            <button type="button" class="btn-pdf" onclick="descargarPDFLocal()">Descargar PDF (Solo local)</button>
        </div>
    </form>

    <script>
        function descargarPDFLocal() {
            const contenido = tinymce.get('basic-example').getContent();
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = contenido;
            document.body.appendChild(tempDiv);

            html2pdf().from(tempDiv).set({
                margin: 1,
                filename: 'boletin.pdf',
                html2canvas: { scale: 2 },
                jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
            }).save().then(() => {
                document.body.removeChild(tempDiv);
            });
        }
    </script>

    {% include 'base/componentes/Footer.html' %}
</body>
</html>
